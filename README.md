# vpnns
Linux network namespace configuration to use with OpenVPN client.

Environment variables mentioned below can be set using file vpnns.conf.
Search for vpnns.conf will be performed from current up to home directory.
If not found then will be checked in ~/.config/.
Example of vpnns.conf:
```text
VPNNAMS=yourvpncfg2
```
If VPNNAME is given as environment variable, vpnns.conf will not be searched.

```text
Usage:
    vpnns.sh [ OPTIONS... ]
Create and configure network namespace for isolated environment connected via OpenVPN to remote network.

  OPTIONS:
    --debug         set -x to show all lines executed by bash after parameters were parsed
    --verbose       show some additional information
    --help          hmmmmm...
    --ns-up         create network namespace with generated or provided name;
                    see notes below;
    --ns-down       delete created network namespace;
                    also terminates all applications that uses this namespace (careful!)
    --info          display information about namespace, if created
    --ps            display processes running inside network namespace
    --check         check how connection from within namespace and from host will look for external endpoints
    --check-config  check if kernel configuration meets requirements then exit
    --show-config   just show configuration
    --vpn-up        start OpenVPN client in background
    --vpn-down      terminates OpenVPN client
    --all-up        combine --ns-up, --vpn-up
    --all-down      combine --vpn-down --ns-down
    --exec cmd ...  execute command with parameters within created namespace; should be last argument;
                    will return exit code of 'cmd'
    --wrap cmd ...  combine --all-up --exec cmd ... (wait for termination) --all-down;
                    will return exit code of 'cmd'

VPN configuration should have name "yourvpncfg.ovpn"; set it using variable VPNNAME.
Configuration will be searched in "/home/username/openvpn" and then in "/etc/openvpn". Can be overridden by variable VPNCFGDIR
Routing markers will be autogenerated if not given via ROUTE_MARKER.
Namespace will be autogenerated out of ROUTE_MARKER value if not given via variable VPNNS.   

Generic usage sequence:
   1. VPNNAME=yourvpncfg vpnns.sh --ns-up
   2. VPNNAME=yourvpncfg vpnns.sh --vpn-up
   3. VPNNAME=yourvpncfg vpnns.sh --exec cmd with params, e.g. ip route show
   4. VPNNAME=yourvpncfg vpnns.sh --vpn-down
   5. VPNNAME=yourvpncfg vpnns.sh --ns-down
or
   1. VPNNAME=yourvpncfg vpnns.sh --all-up
   2. VPNNAME=yourvpncfg vpnns.sh --exec cmd with params, e.g. ip route show
   3. VPNNAME=yourvpncfg vpnns.sh --all-down
or
   1. VPNNAME=yourvpncfg vpnns.sh --wrap cmd with params, e.g. ping -c 3 www.google.com
```
# Similar projects

* [OpenConnect Proxy](https://github.com/cernekee/ocproxy)
* [vpnshift.sh](https://github.com/crasm/vpnshift.sh)
* [ovpn-netns](https://github.com/dadevel/ovpn-netns)
* [openvpn-namespace](https://github.com/Phaeilo/openvpn-namespace)
* [openvpn-netns](https://github.com/pekman/openvpn-netns)
* [Search github for more](https://github.com/search?q=linux+network+namespace+openvpn&type=repositories)